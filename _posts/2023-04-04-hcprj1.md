---
title: "[HongikChallenge] 04/04 진행 내용"

categories:
    - HongikChallenge

tag:

toc: true
toc_sticky: true

date: 2023-04-04
last_modified_at: 2023-04-04
---

> 현재 내가 다니고 있는 대학교에는 1학기 동안 자기가 원하는 수업을 설계하고 이를 전행하여 교수님들께 평가받는 수업이 있는데, 내가 속해 있는 팀이 이번 학기에 이를 지원해 수강하게 되었다. 나는 이번 기회를 이용해 하나의 완성된 사이트를 배포하는 것을 목표로 하는 프로젝트를 진행하고자 하였다. 원래는 기획과 설계에 대한 글을 먼저 올리는 게 맞겠지만, 학교 행정상의 문제로 인해 이를 학기중에 게시하면 안된다고 전달받아서, 일단 Github 저장소에 커밋한 내용을 기반으로 매일 진행한 내용들과 내가 코드를 쓰면서 참고한 내용들을 정리하고자 한다. 일단은 하루하루 공부한 내용을 기록하는 ```TIL```처럼, 매일 진행한 커밋 하나하나에 대해 글을 쓰는 것이 목표이다.

## #1. <a href="https://github.com/Hongik-Challenge/hc-backend/commit/2ad124287e375c06ff417fbc2b4555b73aa303c4">chore:저장소 생성</a>

- git에서 ```add```, ```commit```, ```push```  등의 명령어로 변경 내용을 관리할 수 있는 ```.git``` 파일을 생성하였다.
  - ```.git``` 파일의 내부 구조와 관련해서 <a href="https://tecoble.techcourse.co.kr/post/2021-07-08-dot-git/">해당 포스트</a>를 참고하였다.
<br><br>
- git이 관리하지 않을 파일을 지정하기 위한 ```.gitignore``` 파일을 생성하였다.
  - ```.gitignore``` 파일과 관련해서 <a href="https://kyu9341.github.io/Git/2020/08/23/git_gitignore/">해당 포스트</a>를 참고하였다.
  - <a href="https://github.com/Hongik-Challenge/hc-backend/commit/2ad124287e375c06ff417fbc2b4555b73aa303c4#diff-bc37d034bad564583790a46f19d807abfe519c5671395fd494d8cce506c42947"><code>commit</code> 내용</a>은 <a href="https://www.toptal.com/developers/gitignore">gitignore.io</a>을 참고해 작성하였다.
<br><br>
- 협업에서의 원활한 의사소통을 위해 commit message convention을 정해 git에 ```commit```할 때 참고하고자 하였다.
  - 제일 많이 사용되고 있는 <a href="https://udacity.github.io/git-styleguide/">유다시티 커밋 메시지 스타일 가이드</a>를 참고해 아래의 원칙을 작성하였다.

```
1. message structure
- type:subject
- body

2. type
- feat : 새로운 기능 도입
- fix : 버그 수정
- docs : 문서 수정
- style : 코드 포맷팅 (크드 변경이 없는 경우)
- refactor : 코드 리펙토링
- test : 테스트 코드 추가
- chore : 빌드 업무 및 패키지 매니저 수정

3. subject
- 제목에 해당하는 subject는 현재시제로 50자 내외에서 작성한다.

4. body
- 본문에 해당하는 body는 부연설명이 필요한 경우에만 작성한다.
```

## #2. <a href="https://github.com/Hongik-Challenge/hc-backend/commit/6a018a31584d5468d8a2b5a6aa1a31124d3a31b9">chore:프로젝트 생성</a>

- Gradle을 빌드하기 위한 ```build.gradle``` 파일의 plugins와 repositories를 작성하였다.
  - Gradle과 관련해서 <a href="https://velog.io/@appti/series/gradle">해당 포스트</a>와 <a href="https://araikuma.tistory.com/category/IT%20개발/Gradle">해당 포스트</a>를 참고하였다.
<br><br>

```
plugins {
    id 'java'
    id 'org.springframework.boot' version '2.7.10'
    id 'io.spring.dependency-management' version '1.1.0'
}

repositories {
    mavenCentral()
}
```

## #3. <a href="https://github.com/Hongik-Challenge/hc-backend/commit/1e1d43da4c6072c8e25a82c6eb2d7da3382e51f3">chore:멀티모듈 구성</a>

- 프로젝트의 내부를 기존의 root 모듈에 sub 모듈인 Api, Common, Domain, Infrastructure 모듈을 포함시킨 멀티모듈 구조로 변경하였다.
  - 멀티모듈의 설계와 관련해서 <a href="https://velog.io/@freesky/DDD-Start-Architecture">해당 포스트</a>를 참고하였다. 사실 <a href="https://techblog.woowahan.com/2637/">이 포스트</a>를 참고해 설계하려 했지만 이해가 잘 되지 않아 일단 보류했다.
  - 지금 글을 쓰는 중에 의존 관계를 잘못 작성했다는 사실을 발견해버려서 (...) 그 부분을 수정한 다음에 계층 구조를 표현하도록 하고, ```build.gradle```과 ```settings.gradle```에 대한 내용만 서술하도록 하겠다.
<br><br>
- sub 모듈들을 하나의 디렉토리에서 관리하기 위해 ```settings.gradle``` 파일을 작성하였다.
  - 원래 모듈을 생성하는 과정에서 자동으로 작성되는 것으로 알고 있는데 안되서 직접 작성하였다.
  - ```setting.gradle```이 아니라 ```settings.gradle```이다... 이거 하나를 못 찾아서 새벽을 지새웠다.

```
rootProject.name = 'HongikChallenge'
include 'Api'
include 'Common'
include 'Domain'
include 'Infrastructure'
```

- ```build.gradle```에 subprojects와 allprojects 블록을 추가해 하위 모듈과 전체 모듈을 제어할 수 있도록 하였다.

```
allprojects{

}

subprojects{
    group = 'HongikChallenge'
    version = '0.0.1-SNAPSHOT'
    sourceCompatibility = '17'

    repositories {
        mavenCentral()
    }

    apply plugin: 'java'
    apply plugin: 'org.springframework.boot'
    apply plugin: 'java-library'
    apply plugin: 'io.spring.dependency-management'

    configurations {
        compileOnly {
            extendsFrom annotationProcessor
        }
    }
}
```

- 어노테이션 기반으로 반복적으로 작성하는 코드를 자동완성해주는 lombok 라이브러리를 subprojects에 다음과 같은 dependencies으로 추가하였다.

```
compileOnly 'org.projectlombok:lombok'
annotationProcessor 'org.projectlombok:lombok'
```

```
testImplementation 'org.springframework.boot:spring-boot-starter-test'
```

- lombok을 테스팅 환경에서 사용하기 위해 <a href="https://jundragon.tistory.com/9">해당 포스트</a>를 참고해 ```build.gradle```의 subprojects에 다음과 같은 dependencies으로 추가하였다.

```
testCompileOnly 'org.projectlombok:lombok'
testAnnotationProcessor 'org.projectlombok:lombok'
```

- Java에서 단위 테스트를 하기 하기 위해 <a href="https://math-coding.tistory.com/158">해당 포스트</a>를 참고해 JUnit5 프레임워크를 사용할 수 있도록 ```build.gradle```을 변경하였다.

```
tasks.named('test') {
        useJUnitPlatform()
}
```

- 스프링 어플리케이션에서 Junit, Hamcrest, Mockito 등으로 테스트를 가능하게 하도록 ```build.gradle```의 subprojects에 다음과 같은 dependencies으로 추가하였다.

```
testImplementation 'org.springframework.boot:spring-boot-starter-test'
```

- JUnit5 API를 테스팅 환경에서 사용하기 위해 ```build.gradle```의 subprojects에 다음과 같은 dependencies으로 추가하였다.

```
testImplementation 'org.junit.jupiter:junit-jupiter-api:5.8.1'
testRuntimeOnly 'org.junit.jupiter:junit-jupiter-engine:5.8.1'
```

- 멀티모듈 프로젝트를 빌드했을 때 ```bootJar.enabled = false```으로 선언된 root 모듈이 빌드된 배포본에 포함되지 않는 오류가 나는 것을 방지하고자 <a href="https://java.ihoney.pe.kr/512">해당 포스트</a>를 참고해 ```build.gradle```과 ```build.gradle```의 subprojects에 ```jar.enabled = true```을 추가하였다. (원래는 ```build.gradle```의 allprojects에 작성하였으나, 오류가 발생해 불가피하게 수정했다.)

```
bootJar.enabled = false
jar.enabled = true
```

- ```Task 'wrapper' not found in project ':project'``` 오류를 해결하고자 <a href="https://hororolol.tistory.com/546">해당 포스트</a>를 참고하여 ```build.gradle```의 subprojects에서 gradle wrapper를 사용해서 빌드 환경을 맞추었다.

```
task wrapper(type: Wrapper) {
    gradleVersion = '4.4'    
    distributionUrl = distributionUrl.replace("bin", "all")
}
```

- 위의 오류를 해결하는 과정에서 ```Cannot add task 'wrapper' as a task with that name already exists``` 오류가 발생해 <a href="https://taegyunum.tistory.com/entry/Cannot-add-task-wrapper-as-a-task-with-that-name-already-exists">해당 포스트</a>를 참고하여 ```build.gradle```의 subprojects에서 gradle wrapper의 형식을 변경해 해결하였다.

```
wrapper {
        gradleVersion = '4.4'
        distributionUrl = distributionUrl.replace("bin", "all")
}
```

- ```:prepareKotlinBuildScriptModel Task fails in a Java project``` 오류를 해결하고자 <a href="https://charactermail.tistory.com/351">해당 포스트</a>를 참고하여 ```build.gradle```의 subprojects에서 ```prepareKotlinBuildScriptModel```을 새로운 task로 추가하였다.

```
tasks.register("prepareKotlinBuildScriptModel"){}
```

## #4. chore:spotless 적용
- Junit에 대한 코드 포맷팅 및 유지보수를 위해 <a href="https://nesoy.github.io/articles/2020-04/Spotless">해당 게시글</a>을 참고해 spotless 플러그인을 추가하였다.

```
id "com.diffplug.spotless" version "6.16.0"
```

- sub 모듈에서도 spotless 플러그인이 적용될 수 있도록 <a href="https://keelim.tistory.com/entry/안드로이드-멀티-모듈-공통-gradle-그리고-ktlint-적용을-해보자">해당 게시글</a>을 참고해 ```spotless.gradle``` 파일을 별개로 생성했다.

```
spotless {
    version = "6.16.0"

    java {
        // 특정 파일에만 적용
        target("**/*.java")

        // import 순서 정의
        importOrder()

        // 사용하지 않는 import 제거
        removeUnusedImports()

        // 구글 자바 포맷 적용
        googleJavaFormat().aosp()

        // 공백 제거
        trimTrailingWhitespace()

        // 끝부분 New Line 처리
        endWithNewline()
    }
}
```

- 그리고 sub 모듈에서도 spotless 플러그인이 적용될 수 있도록 root 모듈에 ```spotless.gradle``` 파일을 적용시켰다.

```
apply from: "$rootDir/spotless.gradle"
```

## #5. <a href="https://github.com/Hongik-Challenge/hc-backend/commit/c0356c825568ef932a317c5677190c8ea8a9d741">chore:github workflows 생성</a>
- Github에서 제공하는 workflow 자동화 도구인 Github Actions을 사용해 Github flow을 관리할 수 있도록 한다.
  - Github Action과 관련해서 <a href="https://zzsza.github.io/development/2020/06/06/github-action/">해당 게시글</a>을 참고하였다.
<br><br>
- Github flow는 <a href="https://velog.io/@pond1029/Git-Workflow">해당 게시글</a>을 참고해 작성하였다.
  1. 개인 작업은 ```dev``` 브랜치에서 작업하고, 작업이 끝나면 ```pull request```를 생성한다.
  2. ```pull request```에서 코드를 리뷰한 후에 문제가 없으면 ```master``` 브랜치로 병합한다.
  3. master 브랜치에 병합하면 배포 작업을 바로 수행한다. (CI 자동화)
<br><br>
- 3번의 CI 자동화 부분을 먼저 생성하고, 1번과 2번은 그 다음에 작성하려 한다.
  - <a href="https://devjem.tistory.com/76">해당 게시글</a>을 참고하여 Github Actions에서 Gradle을 캐싱할 수 있도록 하였다.
  - <a href="https://velog.io/@bagt/Github-Actions를-통한-배포">해당 게시글</a>을 참고하여 AWS를 통한 배포 자동화 (CI)를 위해 빌드된 프로젝트를 미리 압축하도록 하였다.