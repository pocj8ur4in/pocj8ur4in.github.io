---
title: "[vocawik] 05/14 진행 내용"

categories:
    - vocawik

tag:

toc: true
toc_sticky: true

date: 2023-05-14
last_modified_at: 2023-05-14
---

## 생각 정리 (2)

```
사람을 관리하는 서비스를 만들거야, 그러니 사람에 대한 데이터베이스가 필요해
  db_human ()

사람은 이름, 성별, 주소, 이렇게 세가지 정보를 가져
  db_human (name, gender, address)

근데 사람들이 엄청나게 많은 서비스로 설계할꺼야.
이름은 고유값이니 일대일 관계고, 성별은 다대다 관계이지만 성별은 몇개 안되니까 따로 성별에 대한 데이터베이스는 만들 필요가 없을 것 같아
이제 문제는 주소인데, 여기서 상세주소 정보는 중요하지 않다고 생각해보자
그러니까 서울시, 마포구 까지의 정보가 중요한거야, 이거 관련해서 데이터베이스를 만드는 게 효율적인 것 같아
그러면 address1, address2 이런 정보를 가진 데이터베이스를 만들꺼야
  db_address(address1, address2)
    - 서울시  마포구,...
    - 경기도  수원시,...
    - 제주도  제주시,...

근데 곰곰히 생각해보니까 서울시는 도시니까 경기도랑 같은 위계에 있을 수 없어 (라고 생각해볼께)
여기서 내가 생각한 거는 db_address(address1, address2)에서 address3를 추가하는 것은 유지보수에 별로겠지?, 해서
차차리 대한민국과 같은 슈퍼 칼럼을 두고, 대한민국 -> 서울시, 경기도, 제주도
    - 서울시 -> 마포구, ...
    - 경기도 -> ..., 수원시 -> ...
    - 제주도 -> ..., 제주시 -> ...
로 표현하려 했어, 이러면 평양시가 추가되도 대한민국이라는 기존 카테고리에 넣거나 북한이라는 신규 카테고리를 만들어서 관리할 수 있을거고, 또 이러면 외국인들도 관리할 수 있을거야

이거를 DB 설계에 반영하는 것 또한 생각했는데 java의 extend 키워드처럼 하위 클래스가 상위 클래스를 가리키게 하는거야
사람이 마포구에 속한다, 처럼 마포구는 서울시에 속한다, 서울시는 대한민국에 속한다는 것을 표현하기 위해 칼럼을 무한정 늘리는 대신, relation이라는 칼럼을 만들어서 정보를 넣을거야
이러면 클라이언트가 강남구, 서초구, 송파구를 강남3구로 관리하는 기능을 만들테니까 이를 설계해! 라고 해도
클라이언트가 분명 앞으로 이런 기능을 계속 요구할테니까, 아예 슈퍼 칼럼을 관리하는 서비스를 추가해버리자
  강남3구라는 슈퍼 칼럼은 강남구, 서초구, 송파구를 포함한다
  강남구는 강남3구라는 슈퍼칼럼에 소속된다
라는 두가지 기능을 하는 서비스를 만들어서 굳이 개발자가 끙끙거리지 않아도 사이트 관리자가 대응할 수 있을거야
  db_address(address, relation)

저 위의 설계대로라면 강남3구가 강남4구가 되어도, 경기도가 경기남도나 경기북도가 되어도,
그에 따라 DB를 관리하는 기능을 만들면 돼. 즉, DB의 칼럼은 정적이니까, 기능을 통해 동적으로 관리하려고 시도할꺼야

근데 이제 문젠데, 클라이언트가 어? 도청들에 전화하는 기능이 빠졌네? 그거 "해줘"라고 했다고 생각해볼께
지자체 -> 경기도, 제주도, ...에는 당연히 전화번호 정보가 없어
그런데 db_address(address, relation, phoneNumber)로 설계할 경우 마포구, 강남3구, 대한민국과 같은 지자체가 아닌 데이터 객체에도 반영될거야
또 클라이언트가 요구사항 계속해서 바꿀 수 있다는 것까지 고려하면 db_address(address, relation, phoneNumber...) 이런식으로 게속 늘어날거야

차라리 그러면, 추가 정보 목록과 그에 대한 정보를 담는 데이터베이스를 만들어서
  db_additionInterface(additionData, superAddress)
  db_additionData1(address, additionData1)
  db_additionData2(address, additionData2)

즉, 전화번호 정보는 지자체에 포함되며 경기도의 전화번호는 XXX, 제주도의 전화번호는 YYY...
부동산 시세 정보는 강남3구에 포함되며 강남구의 부동산 시세는 A, 서초구의 부동산 시세는 B, ...

그런데 이렇게 하는 게 합리적일까? 한줄 요약하면, 데이터베이스를 정적으로 관리하기 위해 서비스에 다 책임을 던져버리는 것이 과연 옳은 설계일까?
...
```

라는 고민이 데이터베이스 설계 과정에서 생겨나서 나 혼자서 며칠 정도 끙끙대다가 여러 지인들에게 물어보았는데, 이에 대한 찬반이 굉장히 많이 갈렸다. 그중에 '어떤 규칙에 관한 데이터베이스를 만드는 것은 서비스 계층에 모든 것을 위임하는 것이니 DB 설계에서 바람직한 행위는 아니니 유지보수할 때마다 데이터베이스의 칼럼을 늘리거나, 아니면 아예 해당 정보에 대한 데이터베이스를 증설해서 대응하는 것이 낫지 않아?'라는 의견이 있어 조금 더 고민해보고 이에 답할 계획이다.

## <a href="https://github.com/pocj8ur4in/vw-backend/commit/10b4d01142893813ddac951f9c3096ad2e103eef">#11</a>. feat/user: user 도메인 생성

- UserDomain: 일반 로그인 (LoginService)
  - (로그인 화면에서 아이디 혹은 이메일과 비밀번호를 입력하면,)
    - 아이디와 이메일을 판별하고,
    - 아이디 혹은 이메일이 DB에 존재하는지 각각 검증하고,
    - 비밀번호를 검증하고,
    - 위의 검증이 모두 성공하면,
      - JWT 토큰, 즉 AccessToken, RefreshToken을 생성해 출력하고,
      - (메인 화면으로 이동한다.)

- UserDomain: 일반 회원가입 (RegisterService)
  - (회원가입 트리거를 통해 접속한,)
  - (회원가입 약관 동의 화면에서 입력한) 회원가입 약관이 모두 동의되었으면,
    - (회원가입 화면이 출력된다.)
  - (회원가입 화면에서 회원가입 양식을 입력하면,)
    - 아이디가 DB에 중복되는지 검증하고,
    - 닉네임이 DB에 중복되는지 검증하고,
    - 이메일이 DB에 중복되는지 검증하고,
    - 비밀번호를 검증하는데,
      - 비밀번호가 최소 1개 이상의 알파벳 소문자, 최소 1개 이상의 알파벳 대문자, 최소 1개 이상의 특수문자, 8~32자리인지 검증하고,
      - 비밀번호가 반복된 문자열인지 검증하고,
      - 비밀번호가 3개 이상의 문자가 연속된 문자열인지 검증하고,
      - 비밀번호가 아이디를 포함하는지 검증하고
    - 생일이 현재 날짜보다 빠른지 검증하고,
    - 위의 검증이 모두 성공하면,
      - 데이터베이스에 이를 저장하고,
      - (초기 설정 화면으로 이동한다.)

위와 같이 백엔드에 처리되어야 하는 비즈니스 로직을 구상하고, 이를 프로젝트에 반영하였다. 왜 데이터베이스 설계도 안했는데 기능이 먼저 튀어나왔냐! 라고 생각할 수 있는데, 앞서 생각해둔 클래스 규칙을 실제 코드로 옮기면서 수정 및 추가할 부분을 고민해봐야 해서 다른 계층의 작업들은 아예 배제해둔 상태로 도메인 계층 내의 작업만 진행하였다. 보통 협업할 때에 Example 도메인을 상호 간에 정의하고 프로젝트를 시작하는데, 약간 그 느낌으로 생각하고 작업을 진행하였다.