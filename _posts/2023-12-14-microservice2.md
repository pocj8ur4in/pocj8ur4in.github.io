---
title: "[MicroService] 2. MSA"

tags:
    - MicroService

toc: true
toc_sticky: true

date: 2023-12-14
last_modified_at: 2023-12-14
---

## 마이크로서비스 아키텍처 (```MSA```) : 마이크로서비스를 접목한 아키텍처 구조

- 클라우드 인프라와 접목해 아마존, 넷플릭스에 의해 구체화 → 비즈니스 성공 사례
- 각 서비스는 개별 프로세스에서 실행되며, ```HTTP API```를 통해 통신
- 각 서비스는 비즈니스 기능 단위로 구성되고, 자동화된 배포 방식을 이용해 독립적으로 배포

> 마이크로서비스 아키텍처 (```MSA```)와 서비스 지향 아키텍처 (```SOA```)의 비교
> - ```SOA``` : 컴포넌트를 모아 비즈니스적으로 의미있고 완결적인 서비스 단위로 모듈화
>   - ```SOA```와 ```MSA```의 공통점 : 비즈니스 서비스의 집합으로 시스템을 개발
>   - ```SOA```와 ```MSA```의 차이점 : 이론적인 ```SOA```와 달리, ```MSA```는 클라우드 인프라와 접목해 구체화

- ```MSA``` 내부 아키텍처 : ```API```, 비즈니스 로직, 이벤트 발행, 데이터 처리의 구조화 등 ```MSA``` 내부 구조를 정의한 것
- ```MSA``` 외부 아키텍처 : 인프라, 플랫폼, 어플리케이션 영역에 있는 구성 요소 및 그것들의 관계를 정의하는 것

### 리액티브 선언 (```The Reactive Manifesto```) : 어플리케이션이 요청에 즉각 응답하고 가동되길 기대
- 응답성 (```Responsive```) : 사용자에게 신뢰성 있는 응답을 빠르고 적절히 제공하는 능력
- 탄력성 (```Resilient```) : 장애가 발생하더라도 시스템 전체에 영향을 주지 않고 복구하는 능력
- 유연성 (```Elastic```) : 사용량에 변화가 있더라도 그에 비례해 자원을 조절해 균일한 응답성을 제공하는 능력
- 메시지 기반 (```Message Driven```) : 비동기 메시지로 위치 투명성, 느슨한 결합, 논블로킹 통신을 지향

→ 4가지 요건을 만족하는 시스템을, 급변하는 상황을 적응할 수 있는 리엑티브 시스템 (```Reactive System```)이라 정의

### 강결합에서 약결합의 아키텍처로의 변화
- 소프트웨어 아키텍처 : 소프트웨어를 구성하는 요소와 그 구성 요소 간의 관계를 정의한 것
  - 아키텍처를 정의하는 과정 : 시스템 구축을 위한 여러 비기능 요건들을 만족하는 해결 방법을 찾는 과정
    - 비기능 요건 : 시스템 성능, 시스템 가용성, 보안, 유지보수성, 확장성 등
  - 마이크로서비스 아키텍처는 '클라우드'라는 가상화된 인프라를 활용한 것이므로, 이를 고려해 설계해야 함
- 아키텍처 유연성 (```Architecture Flexibility```) : 시스템 자체가 변화 및 확장에 언제든지 대응할 수 있는 능력
  - 시스템을 구성하는 구성 요소 간의 관계들이 느슨하게 결합되어 언제든지 대체되거나 확장될 수 있음
  - 리액티브 시스템이 리액티브하기 위해서 반드시 갖춰야 할 특성 중 하나
  - 클라우드 인프라 자체가 유연성과 확장성을 갖추므로, 어플리케이션 아키텍처 또한 아키텍처 유연성이 필요


<iframe width="90%" height="350" style="border:none" src="https://landscape.cncf.io/?category=automation-configuration&grouping=category&fullscreen=yes"></iframe>

- 과거 : 아키텍처 구성 요소들이 특정 벤더의 제품에 전적으로 의존
  - 유명한 제품군을 사용함으로 품질이 보장될 수 있음
  - 특정 기술에 락인 (```lock-in```)되어 시스템을 쉽게 변경하거나 확장하기 어려움
- 현재 : 클라우드 환경 아래에서 사용하는 오픈 소스 기반 제품들이 충분한 기능, 품질, 호환성을 제공
  - 아키텍처 설계가 필요한 레이어에서 적절한 솔루션을 선택하고 이를 조합하는 개방적 방식으로 변화
  - 클라우드 기반 어플리케이션의 구축에 필요한 인프라 및 어플리케이션 영역에 다양한 제품들이 등장

## ```MSA``` 패턴 : ```MSA```의 문제 영역에 대해 여러 사람들에 의해 검증되어 정리된 스타일 혹은 패턴
- 인프라 구성 요소 : 마이크로서비스를 지탱하는 인프라스트럭처를 구축하는 데에 필요한 구성 요소
- 플랫폼 패턴 : 인프라 위에서 마이크로서비스의 운영과 관리를 지원하는 플랫폼 차원의 패턴
- 어플리케이션 패턴 : 마이크로서비스 어플리케이션을 구성하는 데에 필요한 패턴

### 인프라 구성 요소를 서비스 유형별로 나누어 해당되는 제품 중 하나를 의사결정 → 클라우드 인프라
- ```IaaS``` (```Infrastructure as a Service```) : 가상 머신, 스트리지, 네트워크 등 인프라 제공
  - 고객이 관리할 수 있는 범위가 가장 넓은 클라우드 컴퓨팅 서비스
  - ```AWS``` 등 퍼플릭 클라우드 공급 업체 (```CSP```)가 준비한 환경을 고객이 선택할 수 있음
  - 가상화된 물리적 자원을 ```UI``` 형태의 대시보드 혹은 ```API``` 형태로 제공
  -  고객은 서버와 스트리지에 접근할 수 있지만, 클라우드 내 가상 데이터 센터를 통해 리소스를 전달받는 형태
  - 개발자는 운영체제와 어플리케이션을 직접 관리해야 함 : 개발자와 인프라 관리자의 역할이 분담
  - 예시 : ```AWS EC2```, ```AWS S3```
- ```CaaS``` (```Container as a Service```) : 업로드, 구성, 실행, 확장, 중지할 수 있는 컨테이너 제공
  - 가상 머신이 아닌 컨테이너를 기본 리소스로 활용해 어플리케이션을 개발, 실행, 관리
  - 컨테이너화된 어플리케이션을 빌드하고 배포하는 개발 환경은 퍼플릭 클라우드 공급 업체 (```CSP```)가 제공
  - 예시 : ```Kubernetes Service```, ```AWS ECS```
- ```PaaS``` (```Platform as a Service```) : 어플리케이션에 미들웨어, 런타임까지 탑재한 플랫폼을 제공
  - 가상화된 클라우드 위에 원하는 서비스를 개발할 수 있도록 개발 환경을 미리 구축해 서비스 형태로 제공
  - 고객은 개발 환경을 고려할 필요 없이 어플리케이션 자체에 집중할 수 있음
  - 어플리케이션이 플랫폼에 종속되어 개발되므로, 다른 플랫폼으로의 이식이 어려울 수도 있음
  - 예시 : ```Lambda```, ```AWS Elastic Beanstalk```

### 시스템의 기반이 되는 인프라 레이어의 구축 → 베어메탈 장비 혹은 가상 인프라 환경을 통한 구축
- 가상 인프라 환경 : 하이퍼바이저 (```Hypervisor```)의 사용 여부 및 게스트 OS 유무에 따라 나뉨
  - 가상 머신 (```VM```) : 하이퍼바이저를 통해 하나의 시스템에서 여러 운영체제를 사용
    - 운영체제 패치 및 관련 라이브러리 설치로 인한 오버헤드가 지속적으로 발생
  - 컨테이너 (```Container```) : 컨테이너 엔진을 사용해 가상의 격리된 공간을 생성
    - 도커 (```Docker```) : 필요 라이브러리나 실행 파일을 여러 레이어 이미지로 제어
      - 이식성 : 도커만 실행할 수 있으면 호스트 커널에 상관없이 동일하게 사용
      - 신속성 : 크기가 작고 가벼워 빠른 배포가 가능 + 문제 발생 시 다시 가동하면 됨
      - 재사용성 : 동일한 환경을 재사용해 쉽게 설정 가능 → 서버 환경 구축이 쉬워짐
  - 컨테이너 오케스트레이션 (```Container Orchestration```) : 컨테이너 관리 기술
    - 컨테이너 배치 및 복제, 확장 및 축소, 장애 복구 컨테이너 간 통신, 로드밸런싱 등
    - 쿠버네티스 (```Kubernetes```) : ```Pod```, ```Deployment```, ```Replica Sets``` 정보 확인 가능
      - 각 컨테이너가 요구하는 자원을 쿠버네티스에 요청하면 노드에 맞춰 자동 배치
      - 컨테이너 이상을 점검해, 실패하면 컨테이너를 자동으로 교체하고 리스케줄링
      - 일정량의 ```CPU``` 및 메모리 사용량을 초과하면 자동으로 수평 확장

### 마이크로서비스의 운영과 관리를 지원할 클라우드 플랫폼 (미들웨어)의 구축 → 플랫폼 패턴
- 데비옵스 (```DevOps```) : 개발과 운영이 분리되지 않은 개발 및 운영을 병행할 수 있는 조직 또는 문화
  - 소프트웨어를 빠르게 개발하게끔 지원하는 빌드, 테스트, 배포를 위한 자동화 환경
  - 지속적 제공 (```CI```) : 빌드된 소스 코드의 실행 파일을 실행 환경에 반영하기 전에 진행
  - 지속적 배포 (```CD```) : 저장소에 빌드한 소스 코드의 실행 파일을 실행 환경까지 자동으로 배포

> 자동 빌드 및 배포 절차
> 1. 매일 자신이 작성한 소스 코드와 이를 테스트할 테스트 코드를 형상관리 시스템에 보낸다. (```Push```)
> 2. 매일 빌드 도구에서 형상관리 서버의 코드를 가져와 (```Pull```) 통합하고, 자동으로 빌드하고 테스트를 수행한다.
> 3. 테스트 수행 결과를 리포트에 기록하고, 빌드된 소스 코드를 스테이징 환경에 자동으로 배포한다.
> 4. 테스터가 스테이징 환경에서 테스트를 수행할 때 혹은 리포트 결과에 문제가 있으면, 소스 코드를 수정한다.

- 빌드·배포 파이프라인의 설계 : 빌드·배포 과정동안 수행해야 할 업무 (```task```)를 정의한 것
  - 리포지토리에서 소스 코드를 가져와 빌드해 실행 파일을 만드는 작업
  - 이전 작업이 성공하면, 다음 작업이 자동으로 수행히게끔 위의 작업들을 관리하는 작업
  - 실행할 어플리케이션을 실행 환경에 배포하는 작업

  → ```IaaS```를 통해 빌드·배포 파이프라인의 절차를 완벽하게 자동화할 수 있음


> Reference
>
> - <a href="https://www.aladin.co.kr/m/mproduct.aspx?ItemId=285280054">도메인 주도 설계로 시작하는 마이크로서비스 개발</a>